PROJECTS =	alpha \
			bitmapfill \
			blur \
			button \
			coloreffects \
			curve \
			curvefill \
			earth \
			emptyclips \
			filters \
			font \
			group \
			guide \
			guidespeed \
			likebutton \
			linearfill \
			lines \
			mask \
			maskfilter \
			mirror \
			nestedit \
			radialfill \
			shape \
			solidfill \
			text \
			textmask \
			textureatlas \
			transform \
			tween \
			video \
			WaterLogic

DST_LIST = $(addsuffix .release,$(PROJECTS))

build: $(addsuffix /library.js,$(DST_LIST))

rebuild: clean build

clean:
	@for PROJECT in $(PROJECTS) ;\
	do \
		rm -rf $$PROJECT/.vscode ;\
		rm -rf $$PROJECT/node_modules ;\
		rm -rf $$PROJECT/src/autogenerated ;\
		rm -f  $$PROJECT/src/application.ts ;\
		rm -f  $$PROJECT/package.json ;\
		rm -f  $$PROJECT/package-lock.json ;\
		rm -f  $$PROJECT/tsconfig.json ;\
		rm -f  $$PROJECT/webpack.config.js ;\
	done
	
	@for DST in $(DST_LIST) ;\
	do \
		rm -rf $$DST ;\
	done


%.release/library.js:
	if [ -f $*/$(*F).nfl ]; then \
		../ide/bin/nanofl.exe $*/$(*F).nfl -save -publish -quit ;\
	fi
	if [ -f $*/package.json ]; then \
		cd $* && npm i && npm run build ;\
	fi
	
	#if [ -f $(basename $@)/$(basename $@).xfl ]; then \
	#	../ide/nanofl.exe $(basename $@)/$(basename $@).xfl -publish -quit ;\
	#fi
